import{_ as q,c as J}from"./_plugin-vue_export-helper.a85d8817.js";import{e as i,r as K,d as N,x as C,f as Q,t as R,c as D,b as A,F as X,z as W,j as Y,o as b,n as Z,g as x,h as V}from"./runtime-core.esm-bundler.23703bfe.js";/* empty css                       */const _=typeof document=="object"?document:void 0;_?.body;function B(e,a){(typeof e.cancelable!="boolean"||e.cancelable)&&e.preventDefault(),a&&e.stopPropagation()}const ee=(e,a,c)=>Math.min(Math.max(e,a),c),te=e=>isNaN(Number(e))?String(e):`${e}px`,F=10;function oe(e,a){return e>a&&e>F?"horizontal":a>e&&a>F?"vertical":""}function ne(){const e=i(0),a=i(0),c=i(0),t=i(0),v=i(0),h=i(0),n=i(0),r=i(0),f=i(""),S=()=>f.value==="vertical",k=()=>f.value==="horizontal",y=()=>{v.value=0,h.value=0,n.value=0,r.value=0,f.value=""};return{move:g=>{const p=g.touches[0];v.value=p.clientX-e.value,h.value=p.clientY-a.value,c.value=p.clientX,t.value=p.clientY,n.value=Math.abs(v.value),r.value=Math.abs(h.value),f.value||(f.value=oe(n.value,r.value))},start:g=>{y(),e.value=g.touches[0].clientX,a.value=g.touches[0].clientY},reset:y,startX:e,startY:a,moveX:c,moveY:t,deltaX:v,deltaY:h,offsetX:n,offsetY:r,direction:f,isVertical:S,isHorizontal:k}}const{componentName:ie,create:ae}=J("pickcolumn"),se=ae({props:{value:[String,Number],columnsType:String,column:{type:Array,default:()=>[]},threeDimensional:{type:Boolean,default:!0},swipeDuration:{type:[Number,String],default:1e3},visibleOptionNum:{type:[Number,String],default:7},optionHeight:{type:[Number,String],default:36}},emits:["click","change"],setup(e,{emit:a}){const c=ne(),t=K({touchParams:{startY:0,endY:0,startTime:0,endTime:0,lastY:0,lastTime:0},currIndex:1,transformY:0,scrollDistance:0,rotation:20}),v=i(null),h=i(!1),n=i(0),r=i(0),f=200,S=300,k=15,y=N(()=>({transition:`transform ${r.value}ms cubic-bezier(0.17, 0.89, 0.45, 1)`,transform:`rotate3d(1, 0, 0, ${n.value})`,top:`calc(50% - ${+e.optionHeight/2}px)`})),P=N(()=>{const{optionHeight:o}=e;return{transition:`transform ${r.value}ms cubic-bezier(0.17, 0.89, 0.45, 1)`,transform:`translate3d(0, ${t.scrollDistance}px, 0)`,top:`calc(50% - ${+o/2}px)`,height:`${o}px`}}),$=o=>`transform: rotate3d(1, 0, 0, ${-t.rotation*o}deg) translate3d(0px, 0px, 104px)`,g=N(()=>({backgroundSize:`100% ${(+e.visibleOptionNum-1)*+e.optionHeight/2}px`})),p=o=>{if(c.start(o),h.value){let l=v.value;const{transform:s}=window.getComputedStyle(l);if(e.threeDimensional){const u=Math.floor(parseInt(n.value)/360),m=+s.split(", ")[5],d=+s.split(", ")[6]<0?180:0,M=u*360+Math.acos(m)/Math.PI*180+d;t.scrollDistance=-Math.abs((M/t.rotation-1)*+e.optionHeight)}else console.log(+s,"transform"),t.scrollDistance=+s.slice(7,s.length-1).split(", ")[5]}B(o,!0),t.touchParams.startY=c.deltaY.value,t.touchParams.startTime=Date.now(),t.transformY=t.scrollDistance},O=o=>{c.move(o),c.isVertical()&&(h.value=!0,B(o,!0)),t.touchParams.lastY=c.deltaY.value;let l=t.touchParams.lastY-t.touchParams.startY;T(l)},j=()=>{t.touchParams.lastY=c.deltaY.value,t.touchParams.lastTime=Date.now();let o=t.touchParams.lastY-t.touchParams.startY,l=t.touchParams.lastTime-t.touchParams.startTime;if(l<=S&&Math.abs(o)>k){const s=L(o,l);T(s,"end",+e.swipeDuration);return}else T(o,"end");setTimeout(()=>{c.reset(),h.value=!1},0)},L=(o,l)=>(o=Math.abs(o/l)/.003*(o<0?-1:1),o),U=o=>o>=t.currIndex+8||o<=t.currIndex-8,w=(o=0,l,s=f,u)=>{l==="end"?r.value=s:r.value=0,n.value=u,t.scrollDistance=o},T=(o,l,s)=>{const{optionHeight:u}=e;let m=o+t.transformY;if(l==="end"){m>0&&(m=0),m<-(e.column.length-1)*+u&&(m=-(e.column.length-1)*+u);let d=Math.round(m/+u)*+u,M=`${(Math.abs(Math.round(d/+u))+1)*t.rotation}deg`;w(d,l,s,M),t.currIndex=Math.abs(Math.round(d/+u))+1}else{let d=0,M=(-m/+u+1)*t.rotation;const E=(e.column.length+1)*t.rotation,z=0;d=ee(M,z,E),z<d&&d<E&&(w(m,null,void 0,d+"deg"),t.currIndex=Math.abs(Math.round(m/+u))+1)}},H=()=>{a("change",e.column[t.currIndex-1])},I=o=>{const{column:l}=e;let s=l.findIndex(m=>m.value==e.value);t.currIndex=s===-1?1:s+1;let u=s===-1?0:s*+e.optionHeight;o&&H(),T(-u)},G=()=>{h.value=!1,r.value=0,H()};return C(()=>e.column,o=>{e.column&&e.column.length>0&&(t.transformY=0,I(!1))},{deep:!0}),C(()=>e.value,o=>{t.transformY=0,I(!1)},{deep:!0}),Q(()=>{I(!0)}),{...R(t),...R(e),setRollerStyle:$,isHidden:U,roller:v,onTouchStart:p,onTouchMove:O,onTouchEnd:j,touchRollerStyle:y,touchTileStyle:P,setMove:T,stopMomentum:G,pxCheck:te,maskStyles:g}}});function le(e,a,c,t,v,h){return b(),D("view",{class:"cannonui-picker__list",onTouchstart:a[1]||(a[1]=(...n)=>e.onTouchStart&&e.onTouchStart(...n)),onTouchmove:a[2]||(a[2]=(...n)=>e.onTouchMove&&e.onTouchMove(...n)),onTouchend:a[3]||(a[3]=(...n)=>e.onTouchEnd&&e.onTouchEnd(...n))},[A("view",{class:"cannonui-picker-roller",ref:"roller",style:Y(e.threeDimensional?e.touchRollerStyle:e.touchTileStyle),onTransitionend:a[0]||(a[0]=(...n)=>e.stopMomentum&&e.stopMomentum(...n))},[(b(!0),D(X,null,W(e.column,(n,r)=>(b(),D(X,{key:n.value?n.value:r},[n&&n.text&&e.threeDimensional?(b(),D("view",{key:0,class:Z(["cannonui-picker-roller-item",{"cannonui-picker-roller-item-hidden":e.isHidden(r+1)}]),style:Y(e.setRollerStyle(r+1))},x(n.text),7)):V("",!0),n&&n.text&&!e.threeDimensional?(b(),D("view",{key:1,class:"cannonui-picker-roller-item-tile",style:Y({height:e.pxCheck(e.optionHeight)})},x(n.text),5)):V("",!0)],64))),128))],36),A("view",{class:"cannonui-picker-roller-mask",style:Y(e.maskStyles)},null,4)],32)}const me=q(se,[["render",le],["__scopeId","data-v-5f6f3c80"]]);export{me as P};
